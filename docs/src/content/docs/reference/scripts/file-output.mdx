---
title: File Output
sidebar:
    order: 5
description: Learn how to declare and manage script-generated file outputs with defFileOutput function.
keywords: file output, script documentation, defFileOutput, schema validation, JSON keywords
---
import { Image } from "astro:assets"
import fileRefactorPng from "../../../../assets/file-refactor-preview.png"
import fileRefactorPngAlt from "../../../../assets/file-refactor-preview.png.txt?raw"

Reliable file generation, both new or updates, is one of the most challenging part of working with LLMs. GenAIScript script supports a few approaches and formats to generate files: for small files, regenerating the entire content is typically more efficient. 
For large files, generate edits is more efficient.

## How it works

GenAIScript automatically adding a [system message](/genaiscript/reference/scripts/system#systemfiles) that teaches the LLM how to format the output files.

Let's start with a script that generates a poem and asks the GenAIScript to save it to a text file.

```js
$`Generate a 1 sentence poem and save it to a text file.`
```

Since no system prompt is specified, GenAIScript adds the default set of system prompts, including the `system.files` prompt. This prompt instructs the LLM to generate a file with the output of the script.
The LLM responds with a code section that also mentions a filename. This is the format that GenAIScript can automatically parse out.

`````md
FILE ./poem.txt:
```
In twilight's gentle embrace, dreams dance like whispers on the breeze.
```
`````

In Visual Studio Code, a refactoring preview is opened with the change.

<Image
    src={fileRefactorPng}
    alt={fileRefactorPngAlt}
    loading="lazy"
/>

### Apply Edits

By default, file edits are not applied automatically. In Visual Studio Code, a refactoring preview is opened and the user can accept or reject the changes. 
In the CLI, the changes are silently ignored unless the `--apply-edits` flag is used.

```sh
npx genaiscript run ... --apply-edits
```

## Declaring file outputs

The `defFileOutput` function lets you declare file output paths and the purpose of those files. This function is used to specify the output files that are generated by the script.

```js
defFileOutput("src/*.md", "Product documentation in markdown format")
```

### Schema Validation

You can associate a [JSON schema](/genaiscript/reference/scripts/schema) with the file output. This schema is used to validate the content of the file before it is written to disk.

```js "schema"
const schema = defSchema("KEYWORDS", {
    type: "array",
    items: {
        type: "string",
    },
})
defFileOutput("src/rag/*.keywords.json", "An array of keywords in the file", {
    schema,
})
```

## System prompts

The support for generating files is defined in a few system prompts. These prompts are typically automatically added but you may need to add them back if you specify a custom set of system prompts.

- [system.files](/genaiscript/reference/scripts/system#systemfiles), instructs the "full" file format
- [system.changelog](/genaiscript/reference/scripts/system#systemchangelog), instructs the "changelog" file format
- [system.files](/genaiscript/reference/scripts/system#systemfiles_schema), instructs JSON schema in file generation

