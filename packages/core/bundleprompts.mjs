import { readdirSync, readFileSync, writeFileSync } from "fs";
const dir = "./src/prompts";
const fp = "./src/default_prompts.ts";
console.debug(`bundling ${dir}/*.prompt.js into default_prompts.ts`);
const promptMap = {};
const ftMap = {};
const prompts = readdirSync("./src/prompts");
for (const prompt of prompts) {
    if (!prompt.endsWith(".js")) continue;
    const text = readFileSync(`${dir}/${prompt}`, "utf-8");

    if (prompt.endsWith(".prompt.js"))
        promptMap[prompt.replace(/\.prompt\.js$/, "")] = text;
    else if (prompt.endsWith(".filetype.js"))
        ftMap[prompt.replace(/\.filetype\.js$/, "")] = text;
}

const text = `// autogenerated - node bundleprompts.mjs
export const defaultPrompts: Record<string, string> = ${JSON.stringify(
    promptMap,
    null,
    4
)};

export const defaultFileTypes: Record<string, string> = ${JSON.stringify(
    ftMap,
    null,
    4
)};
\n`;

writeFileSync(fp, text, "utf-8");
